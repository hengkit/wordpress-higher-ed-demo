function myGraph(e){var t=this;t._events={"node.selected":[],"node.unselected":[]},this.registerEvent=function(e,n){t._events[e].push(n)},this._triggerEvent=function(e,n){var r={name:e,node:n},i=t._events[e];$.each(i,function(e,t){t(r)})},this.addNode=function(e){"edgeserver"==e.type?(e.fixed=!0,e.x=a/2,e.y=50):"newrelic"==e.type?(e.fixed=!0,e.x=100,e.y=100):"codeserver"==e.type&&(e.fixed=!0,e.x=100,e.y=225),u.push(e),h()},this.removeNode=function(e){for(var t=0,n=r(e);t<f.length;)f[t].source==n||f[t].target==n?f.splice(t,1):t++;u.splice(i(e),1),h()},this.addLink=function(e,t){r(e)&&r(t)&&(f.push({source:r(e),target:r(t)}),h())};var n,r=function(e){var t=!1;return u.forEach((n,r)=>{n.id==e&&(t=n)}),t},i=function(e){for(var t in u)if(u[t].id===e)return t},a=$(e).innerWidth(),s=$(e).innerHeight(),o=44,c=this.vis=d3.select(e).append("svg:svg").attr("width",a).attr("height",s),l=c.insert("g").attr("class","linkGroup"),d=c.insert("g").attr("class","nodeGroup"),p=!1,v=d3.layout.force().gravity(.5).friction(.75).linkStrength(function(e){return"newrelic"==e.target.type||"codeserver"==e.target.type?0:1}).distance(function(e){return"codeserver"==e.target.type||"newrelic"==e.target.type||"codeserver"==e.source.type||"newrelic"==e.source.type?a/2:(e.source.links.length>5||e.target.type,50)}).charge(function(e){return"appserver"==e.type?-2e4:"newrelic"==e.type||"codeserver"==e.type?0:-2e4}).size([a,s]),u=v.nodes(),f=v.links();c.on("click",function(){d3.event.defaultPrevented||(p&&(t._triggerEvent("node.unselected",p),p=!1,n()),d3.event.stopPropagation())});var h=function(){var e=d.selectAll("g.node").data(u,function(e){return e.id}).on("click",function(e){d3.event.defaultPrevented||(d.selectAll("g.node").attr("stroke","#EFD01B").attr("background","#313945").attr("fill","#313945").attr("stroke-width",0),p.id==e.id?(p=!1,t._triggerEvent("node.unselected",e)):(p=e,d3.select(this).attr("stroke-width",4),t._triggerEvent("node.selected",e)),n(),d3.event.stopPropagation())}),r=e.enter().insert("g").attr("class","node");r.append("circle").attr("class","bgCircle").attr("r",o),r.append("circle").attr("class",function(e){return"server "+e.type}).attr("r",o),r.append("image").attr("xlink:href",function(e){return"img/"+e.type+".svg"}).attr("class","icon").attr("x",-25).attr("y",-25).attr("width",50).attr("height",50),e.exit().remove();var i=l.selectAll("line.link").data(f,function(e){return e.source.id+"-"+e.target.id});i.enter().insert("line").attr("class",function(e){return classes=["link"],"newrelic"!=e.target.type&&"codeserver"!=e.target.type||classes.push("dashed"),classes.join(" ")}),i.exit().remove(),n=function(){var t=[];i.classed("active",function(e){var n=!1;return e.target.id==p.id&&(n=!0),e.source.id==p.id&&(n=!0),n&&(e.target.id!=p.id&&t.push(e.target),e.source.id!=p.id&&t.push(e.source)),n}),e.classed("inactive",function(e){return!!p&&(!(t.indexOf(e)>-1)&&e.id!=p.id)})},v.on("tick",function(t){e.attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),e.attr("cx",function(e){return e.x=Math.max(o,Math.min(a-o,e.x))}).attr("cy",function(e){return e.y=Math.max(o,Math.min(s-o,e.y))}),u.forEach(function(e,t){"appserver"==e.type?e.y=50:"dbserver"==e.type||"fileserver"==e.type||"cacheserver"==e.type||"indexserver"==e.type?e.y=200:"slavedbserver"==e.type&&(e.y=300)});t.alpha;i.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y})}),v.start()};h()}const $=window.jQuery||{};function Site(e){var t=this;t.reset=function(){t._instances={},t._servers={appserver:[],dbserver:[],slavedbserver:[],cacheserver:[],fileserver:[],newrelic:[],indexserver:[],codeserver:[]},t._links={appserver:["dbserver","cacheserver","fileserver","newrelic","indexserver","codeserver"],dbserver:["slavedbserver"],slavedbserver:[],cacheserver:[],fileserver:[],newrelic:[],indexserver:[],codeserver:[]},t._events={"server.add":[],"server.delete":[]}},t.registerEvent=function(e,n){t._events[e].push(n)},t._triggerEvent=function(e,n){var r={name:e,server:n},i=t._events[e];$.each(i,function(e,t){t(r)})},t.load=function(e){for(var r=[],a=0;a<e.length;a++){var s=i(e[a]);s&&r.push(s)}$.each(t._instances,function(n,r){var i=!1;$.each(e,function(e,t){t.id==n&&(i=!0)}),i||t._deleteServer(n)}),n(),$.each(r,function(e,n){t._triggerEvent("server.add",n)})},t._deleteServer=function(e){var n=r(e);delete t._instances[e],$.each(t._servers[n.type],function(r,i){if(i.id==e)return t._servers[n.type].splice(r,1),!1}),t._triggerEvent("server.delete",n)},t.get=function(e){if("string"==typeof e)return t._servers[e];if(e instanceof Array){for(serverType in t._servers)for(var n=0;n<t._servers[serverType].length;n++)e.push(t._servers[serverType][n]);return e}return r(e.id)?r(e.id):[]};var n=function(){for(id in t._instances)a(t._instances[id])},r=function(e){return!!t._instances.hasOwnProperty(e)&&t._instances[e]},i=function(e){return!r(e.id)&&(t._instances[e.id]=e,t._servers[e.type].push(e),e)},a=function(e){e.links=[];for(var n=t._links[e.type],r=0;r<n.length;r++)for(var i=n[r],a=t._servers[i],s=0;s<a.length;s++)e.links.push(a[s].id);return e};t.reset()}Ember.deprecate=function(){},Ember.warn=function(e){},App=Ember.Application.create(),App.env="";var infobarViewInstance,infobarContentViewInstance,maxWidth=1400,install_dir=window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"))+"/",_marketing={edgeserver:["Pantheon's Edge","The edge has a built-in, ultra-fast cache that's automatically enabled for every site. It improves page load times for our customers and helps sites to cruise through viral traffic spikes without breaking a sweat."],appserver:["Application Container","The essence of a runtime container is a highly tuned PHP-FPM worker and its connections to the outside world. Incoming requests come via an nginx web server which handles requests for static assets, and passes dynamic requests to PHP."],dbserver:["Database Server","The Database Service uses MariaDB and a container architecture similar to the Runtime Matrix to provision DBs and perform workflow operations. Instead of scaling via load-balancing, the DB layer can provide redundancy and horizontal scalability by supporting a self-healing replication topology, which is managed automatically."],slavedbserver:["Failover Database Server(Replica)","The Database Service uses MariaDB and a container architecture similar to the Runtime Matrix to provision DBs and perform workflow operations. Instead of scaling via load-balancing, the DB layer can provide redundancy and horizontal scalability by supporting a self-healing replication topology, which is managed automatically."],cacheserver:["Redis","Available for your applications to use in order to speed up processing."],fileserver:["Pantheon File System","Our PFS (Pantheon File System) is a breakthrough in network-attached storage. It is backed by a self-healing elastic cluster architecture, and its advanced FUSE client rivals local on-disk filesystems for performance, thanks to a thoroughly modern leveldb caching layer."],newrelic:["New Relic APM","It’s about gaining actionable, real-time business insights from the billions of metrics your software is producing, including user click streams, mobile activity, end user experiences and transactions.<img class='img-fluid' src='img/newrelic-graph.png' />"],indexserver:["Apache Solr™","The popular, blazing fast open source enterprise search platform from the Apache Lucene project. Its major features include powerful full-text search, hit highlighting, faceted search, near real-time indexing, dynamic clustering, database integration, rich document (e.g., Word, PDF) handling, and geospatial search."],codeserver:["Git Version Control","Git is a free and open source distributed version control system designed to handle everything from small to very large projects with speed and efficiency."]},environments={basic:{label:"Basic",traffic:"Up to 125K/month",containers:1},performancesmall:{label:"Performance (Small)",traffic:"Up to 125K/month",containers:1},performancemedium:{label:"Performance (Medium)",traffic:"Up to 250K/month",containers:2},performancelarge:{label:"Performance (Large)",traffic:"Up to 750K/month",containers:3},performancexl:{label:"Performance (Extra Large)",traffic:"Up to 1.5M/month",containers:6},elite:{label:"Elite",traffic:"Unlimited",containers:8},elitemax:{label:"Elite (Traffic Spike)",traffic:"Unlimited++",containers:10},multiplesites:{label:"",traffic:"Up to 125K/month",containers:0},disaster:{label:"",traffic:"Up to 125K/month",containers:0}};function getAppTarget(e){return-1!=["dev","test","live"].indexOf(e)&&environments.hasOwnProperty(e)}window.environments=environments,App.Router.map(function(){this.resource("diagram",{path:"diagram/:env_id"})}),App.IndexRoute=Ember.Route.extend({beforeModel:function(){this.transitionTo("diagram")}}),App.DiagramRoute=Ember.Route.extend({model:function(e){return App.env=e.env_id,new Ember.RSVP.Promise(function(t){var n=install_dir+"index.php";"localhost"!=location.hostname&&"127.0.0.1"!=location.hostname&&""===location.port||(n="/data/servers.json",""==App.env&&(App.env="performancelarge")),n=getAppTarget(App.env)?"data/"+App.env+".json":n,$.get(n+"?env="+e.env_id,function(r){window.debugServers=r,App.mySite||(App.mySite=new Site),App.mySite.load(r.servers),t(App.mySite),App.poller&&clearInterval(App.poller),App.poller=window.setInterval(function(){$.get(n+"?env="+e.env_id,function(e){App.mySite.load(e.servers)},"json")},2e3)},"json")})},setupController:function(e,t){e.set("model",t),e.set("graph",!1)}}),App.NavView=Ember.View.extend({templateName:"nav",didInsertElement:function(){var e=this,t=$("#diagramContainer"),n=$(".navbar"),r=$("a[data-env]",n),a=$("#site-tiers span",n);e.appendTrafficIcon=function(e){e=e||"#thecloud";$('<div class="circleIcon"><img src="img/incoming-traffic.svg" /></div>').appendTo(e)},e.resetCloud=function(e){e=e||!1,$("#thecloud").empty(),1==e&&$("#graph-container").empty(),t.removeClass("multiplesites-container").removeClass("disaster-container")},e.updateText=function(){r.removeClass("active");var e=window.environments[App.env];console.log(App.env),console.log(e);var i="Up to 125K/month",s=a.text(),o="us-central1";void 0!==e&&(i=e.traffic,s=e.label,void 0!==e.endpoint_zone&&(o=e.endpoint_zone)),"disaster"==App.env||"multiplesites"==App.env?(t.removeClass("multiplesites-container","disaster-container"),t.addClass(App.env+"-container")):t.removeClass("multiplesites-container","disaster-container");var c='a[data-env="'+App.env+'"]';$(c,n).addClass("active"),$("#internet h5.subtitle").text(i),$("#diagramContainer a.zone").text(o),a.text(s)},r.on("click",n=>{r.removeClass("active"),$(this).addClass("active");var a=$(this).data("env");switch(e.resetCloud(),a){case"multiplesites":e.resetCloud(!0),t.addClass("multiplesites-container"),e.appendTrafficIcon();break;case"disaster":e.resetCloud(!0),t.addClass("disaster-container"),e.appendTrafficIcon();break;default:e.resetCloud();var s=1;for(void 0!==window.environments[a]&&void 0!==window.environments[a].containers&&(s=window.environments[a].containers),i=0;i<s;i++)e.appendTrafficIcon()}}),e.updateText(),$(window).on("hashchange",function(){e.updateText()})}}),App.InfobarView=Ember.View.extend({templateName:"infobarContainer",didInsertElement:function(){infobarViewInstance=this},open:function(){$("#infobarContainer").addClass("emerge").removeClass("hidden"),$("#ember248").addClass("emerge")},close:function(){$("#infobarContainer").removeClass("emerge").addClass("hidden"),$("#ember248").removeClass("emerge")}}),App.InfobarContentView=Ember.View.extend({templateName:"infobarContent",didInsertElement:function(){infobarContentViewInstance=this,this.set("controller.title",""),this.set("controller.text",""),this.get("controller.node")&&this.nodeChange()},nodeChange:function(){if(node=this.get("controller.node"),node){this.set("controller.title",_marketing[node.type][0]),this.set("controller.text",_marketing[node.type][1]),this.set("controller.icon","img/"+node.type+".svg"),$("#infobarContainer").removeClass().addClass(node.type);var e="img/"+node.type+".svg";$(".infobarContent").find(".headerIconWrapper").css("background-image","url("+e+")"),infobarViewInstance.open()}else infobarViewInstance.close()}.observes("controller.node")}),App.DiagramView=Ember.View.extend({templateName:"diagram",didInsertElement:function(){var e=this,t=e.get("controller.graph"),n=App.mySite,r=Math.min($("body").width(),maxWidth)-$("#infobarContainer").width();$("#graph-container").width(r).height(550),$("#infobarContainer").height($("body").height()),t||(n.registerEvent("server.add",function(t){e.drawServer(t.server),e.drawAllLinks()}),n.registerEvent("server.delete",function(t){e.undrawServer(t.server)}),(t=new myGraph("#graph-container")).registerEvent("node.selected",function(e){infobarContentViewInstance.set("controller.node",e.node)}),t.registerEvent("node.unselected",function(e){infobarViewInstance.get("controller.node")==e.node&&infobarContentViewInstance.set("controller.node",!1)}),e.set("controller.graph",t),e.draw())},draw:function(){var e=this,t=(e.get("controller.graph"),App.mySite.get([]));$.each(t,function(t,n){e.drawServer(n)}),e.drawAllLinks()},undrawServer:function(e){this.get("controller.graph").removeNode(e.id)},drawServer:function(e){this.get("controller.graph").addNode(e)},drawAllLinks:function(){var e=this,t=App.mySite.get([]);$.each(t,function(t,n){e.drawLinks(n)})},drawLinks:function(e){var t=this.get("controller.graph");$.each(e.links,function(n,r){t.addLink(e.id,r)})}});